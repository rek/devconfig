#!/bin/zsh

PATTERN="$1"

# allow for searching in other locations, but default to: .
LOCATION=${2:-.}

echo ''
echo "~~~~~~~~ Starting search for '$1' in '$LOCATION' ~~~~~~~"
echo ''

# grep --exclude-dir={node_modules,.nx,.next,storybook-static,.moon,.yarn,.expo,dist,.git,coverage,.venv,sourcemaps,build} --exclude-from={*/eslint-cache*} -rHn --color=auto "${1}" $LOCATION
EXCLUDED_DIRS=(node_modules .nx .next storybook-static .moon .yarn .expo dist .git coverage .venv sourcemaps build)

# Base grep command
CMD=(grep -rHn --color=auto)

for dir in "${EXCLUDED_DIRS[@]}"; do
  CMD+=(--exclude-dir="$dir")
done

CMD+=(--exclude="eslint-cache.json")
CMD+=(--exclude="bun.lock")
CMD+=(--exclude="tsconfig.tsbuildinfo")

# Add pattern and location
CMD+=("${PATTERN}" "$LOCATION")

# debug
# echo $CMD

# Run it
"${CMD[@]}"
